<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{page_title}}</title>
    <meta name="description" content="{{page_description}}" />
    {{meta_extra}}
    <meta name="theme-color" content="#0b0c0f" />
    <link rel="stylesheet" href="{{base_path}}assets/style.css" />
    <link rel="manifest" href="{{base_path}}manifest.webmanifest" />
    <link rel="icon" href="{{base_path}}assets/icon-192.png" />
    <link rel="apple-touch-icon" href="{{base_path}}assets/apple-touch-icon.png" />
    <script>
      window.__PODCAST_INDEX__ = {
        basePath: {{base_path_json}},
        site: {{site_json}}
      };
    </script>
  </head>
  <body class="{{body_class}}">
    <header class="site-header">
      <div class="wrap header-row">
        <div class="brand">
          <a class="brand-link" href="{{base_path}}">{{site_title}}</a>
          <div class="subtitle">{{site_subtitle}}</div>
        </div>
        <nav class="nav">
          <a href="{{base_path}}">Home</a>
          <a href="{{base_path}}categories/">Categories</a>
          <a href="{{base_path}}speakers/">Speakers</a>
          <!-- <a href="{{base_path}}graph/" disabled class="muted">Graph</a> --> 
          <button class="search-button" type="button" data-open-search>Search</button>
          <button class="search-button" type="button" data-open-data>Data</button>
        </nav>
      </div>
    </header>
    <section class="player card" data-player>
      <audio id="player" preload="metadata"></audio>
      <div class="player-top">
        <button class="btn-primary" type="button" id="btn-playpause" aria-label="Play/Pause">Play</button>
        <button class="btn" type="button" id="btn-back15" data-seek-seconds="15" aria-label="Back 15 seconds">-15</button>
        <button class="btn" type="button" id="btn-fwd30" data-seek-seconds="30" aria-label="Forward 30 seconds">+30</button>
        <div class="player-meta">
          <div id="now-title" class="now-title">Select an episode to play.</div>
          <div id="now-sub" class="now-sub muted"></div>
        </div>
        <div class="speed-ctrl" aria-label="Playback speed">
          <button class="btn btn-sm" type="button" id="btn-slower" aria-label="Slower">–</button>
          <span class="speed-readout muted" id="speed-readout">1x</span>
          <button class="btn btn-sm" type="button" id="btn-faster" aria-label="Faster">+</button>
          <button
            class="btn btn-sm speed-settings"
            type="button"
            id="btn-audio-settings"
            aria-label="Audio settings"
            aria-controls="audio-settings"
            aria-expanded="false"
          >
            ⚙
          </button>
        </div>
      </div>
      <details class="player-audio" id="audio-settings">
        <summary class="sr-only">Audio settings</summary>
        <div class="audio-controls">
          <div class="muted" id="audio-note" hidden></div>
          <label class="toggle">
            <input id="preserve-pitch" type="checkbox" checked />
            Preserve pitch
          </label>
          <div class="eq-row">
            <label class="slider">
              Gain <span class="muted" id="gain-val">0 dB</span>
              <input id="gain" type="range" min="-12" max="12" value="0" step="1" />
            </label>
            <label class="slider">
              Bass <span class="muted" id="eq-low-val">0 dB</span>
              <input id="eq-low" type="range" min="-12" max="12" value="0" step="1" />
            </label>
            <label class="slider">
              Mid <span class="muted" id="eq-mid-val">0 dB</span>
              <input id="eq-mid" type="range" min="-12" max="12" value="0" step="1" />
            </label>
            <label class="slider">
              Treble <span class="muted" id="eq-high-val">0 dB</span>
              <input id="eq-high" type="range" min="-12" max="12" value="0" step="1" />
            </label>
          </div>
        </div>
      </details>
      <div class="player-scrub">
        <span class="time muted" id="t-elapsed">0:00</span>
        <input id="scrub" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek" />
        <span class="time muted" id="t-duration">0:00</span>
      </div>
    </section>
    <div class="wrap" id="client-panels">
      <section class="card search-page" id="search-panel" hidden>
        <div class="modal-row" style="justify-content:space-between">
          <div style="font-weight:650">Search</div>
          <button class="btn btn-sm" type="button" data-close-search>Close</button>
        </div>
        <div class="search-row">
          <input id="search-input" type="search" placeholder="Search episodes (title, speakers)..." autocomplete="off" />
        </div>
        <div class="modal-filters">
          <label><input id="search-include-played" type="checkbox" checked /> Include played</label>
          <label><input id="search-played-normal" type="checkbox" /> Played in normal order</label>
        </div>
        <div id="search-status" class="muted">Type to search.</div>
        <ul id="search-results" class="list search-results"></ul>
      </section>
    </div>
    <main class="wrap">
      {{content}}
    </main>
    <footer class="site-footer wrap">{{footer}}</footer>
    <script src="{{base_path}}assets/app.js" defer></script>
    <script type="module">
      // Dev-only: Vite injects HMR; we listen for build/update status messages.
      if (import.meta && import.meta.hot) {
        import("{{base_path}}assets/dev-client.js").catch(() => {});
      }
    </script>
  </body>
</html>
